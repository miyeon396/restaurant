### 데이터 베이스 DDL - 분리 TODO :: 

### 프로젝트 개요
- Spring Batch를 활용하여 CSV 파일을 읽고 데이터베이스(MySQL)에 CSV 데이터를 저장한다.

### 설정 가이드 

### 실행 가이드

### 테스트 가이드 

### 개발 버전
- JDK 17 (Amazon Corretto 17.0.10)
- Spring Framework 6.1.3
- Spring Batch 5.1.2
- mysql 8.0.32
- gradle 8.8


### Processing Time
1. 1차 시도 : 전체 데이터 1000개 Chunk 단일 테이블 Insert
   - Start Time : 2024-08-13 00:07:14.774968
   - End Time : 2024-08-13 00:27:16.926867
   - 소요시간 : 약 20m
   - Skip Count : 3 (2,157,824 insert)
2. 2차 시도 : 1차 시도 + JPA Batch Insert 200개
   - Start Time : 2024-08-13 00:54:14.660754
   - End Time : 2024-08-13 01:12:16.216284
   - 소요시간 : 약 18m
   - Skip Count : 3 (2,157,824 insert)
   - 큰 개선은 없음
3. 3차 시도 : 2차 시도 + 병렬 처리
   - 상세 : 쓰레드풀 활용 여러 쓰레드가 step을 병렬로 처리하며 작업(TaskExecutor)
   - Start Time : 2024-08-13 01:22:25.440823
   - End Time : 2024-08-13 01:31:09.707325
   - 소요시간 : 약 8m
   - Skip Count : 3 (2,157,824 insert)
   - 이슈 : FlatFileItemReader 스레드 세이프
4. 4차 시도 : 2차 시도 + Partitioning
   - 상세 파티션 4 (4개의 파티션으로 나뉘고 각 파티션이 별도의 스레드에서 병렬 처리)
   - St : 2024-08-13 14:25:52.852065
   - End : 2024-08-13 15:01:46.262659
   - 소요 : 약 35m
   - Skip Count : 6 (2,157,824 insert)
   - 이슈 : max값을 Int max로둬서 하나의 파티션에 작업이 몰림  파티션도 너무 작게 나눈거 같음 
5. 5차 시도 : 파티셔닝 조정 
   - 상세 파티션 10 max 3000만
   - St : 2024-08-13 15:07:05.197553
   - End : 2024-08-13 15:15:06.449792
   - 소요 : 약 8m
   - Skip Count : 6 (2,157,824 insert)
   - 이슈 : 노는 파티션이있음 
6. 6차 시도 : 파티셔닝, 스레드 풀 조정
   - 상세 파티션 10 max 220만 스레드 5 max스레드 10
   - St : 2024-08-13 15:20:25.370811
   - End : 2024-08-13 15:28:09.329512
   - 소요 : 7m43s958ms
   - Skip Count : 6 (2,157,824 insert)
   - 나름 균등한 작업 분배 


7. 7차 시도 : 6차시도 + 배치 사이즈 100
- 2024-08-13 15:29:55.036049
- 2024-08-13 15:38:47.827065
- 5개가 CORE라 대기 시ㄴ이 조ㅁ 있ㅡㅁ
-    Skip Count :: 6
- 8m52s768ms

8. 8차 테스트 계획  *** 7차 시도 + 파티셔닝 스레드 풀 조정
- 코어 10 그리드 10 max 10
- 2024-08-13 15:41:22.876491	2024-08-13 15:47:10.047757
- 5m47s171ms
- 여태까지 젤빠름 max로 쓰는게 젤 빠른가

9. 9차 테스트 계획 파티셔닝 스레드 풀 조정
- 코어 10 그리드 15 max 15
- Step: [partitionedStep] executed in 7m49s808ms
- 2024-08-13 15:48:35.656271	2024-08-13 15:56:25.515787
- Skip Count :: 6
- 엑셀 개수를 최적화를 시켜놓아서인지 여유 쓰레드가 많을수록 분배 + 대기 작업으로 속도가 느려짐

10. 10차 테스트 계획 파티셔닝 스레드 풀 조정
- 코어 10 그리드 12 max 12 (여분 하나 두개만) + 카운트 중복 집계 처리
- 2024-08-13 15:58:16.830079	2024-08-13 16:06:41.355699
- Skip Count :: 3
- executed in 8m24s492ms

11. 11차 테스트 파티셔닝 스레드 풀 조정
- 코어 20 그리드 20 max 20
- 디비가 힘들어함 일부 파티션에서 DB 트랜잭션 얻지 못해 Fail
- 1992825
- 6m26s533ms
- Skip Count :: 3
- 2024-08-13 16:09:10.557878	2024-08-13 16:15:37.122560

12. 12차 테스트 파티셔닝 스레드 풀 조정
- 코어 15 그리드 15 max 15
- 2024-08-13 16:17:22.551454	2024-08-13 16:25:06.222524
- 7m43s638ms
- Skip Count :: 3

13. 13차 테스트 파티셔닝 스레드 풀 조정
- 코어 15 그리드 20 max 20 큐 200
- 2024-08-13 16:34:45.857638
- 2024-08-13 16:42:37.252293
- Skip Count :: 3 2157824
- 7m51s370ms

14. 14차 테스트 파티셔닝 스레드 풀 조정 - 마지막 원복 테스트  *** 탕탕탕

- 비슷한거같아서 여기서성능은 이정도고 다른 방법을 찾아보기
- 코어 10 그리드 10 max 15 큐 다시 100
- 2024-08-13 16:46:02.387795
- 2024-08-13 16:46:02.387795	2024-08-13 16:52:33.276782
- 6m30s857ms
- Skip Count :: 3

15. 15차 : select 현상 개선 
- persistable 구현
- 2024-08-13 17:49:04.308752
- 2024-08-13 17:50:28.248287
- executed in 1m23s901ms
- Skip Count :: 3 2157824

16. 16차 update가 안되서 펄시스터블 제거
- 2024-08-13 19:43:23.622244
- 2024-08-13 19:49:12.065694
- 5m48s390ms
- Skip Count :: 3
- 2157824


### Processing Time 
| 시도 | 설명 | Start Time | End Time | 소요시간 | Skip Count | 비고 |
|------|------|------------|----------|----------|------------|------|
| 1차 시도 | 전체 데이터 1000개 Chunk 단일 테이블 Insert | 2024-08-13 00:07:14.774968 | 2024-08-13 00:27:16.926867 | 약 20m | 3 (2,157,824 insert) | |
| 2차 시도 | 1차 시도 + JPA Batch Insert 200개 | 2024-08-13 00:54:14.660754 | 2024-08-13 01:12:16.216284 | 약 18m | 3 (2,157,824 insert) | 큰 개선은 없음 |
| 3차 시도 | 2차 시도 + 병렬 처리 (TaskExecutor 사용) | 2024-08-13 01:22:25.440823 | 2024-08-13 01:31:09.707325 | 약 8m | 3 (2,157,824 insert) | FlatFileItemReader 스레드 세이프 문제 |


